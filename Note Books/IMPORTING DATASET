{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "bf6c8545-b364-4004-bd0e-86d558bc767a",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Install Relevant Libraries\n",
    "%pip install pandas numpy matplotlib seaborn scikit-learn requests"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "cd8c9dbe-df20-45aa-a651-c211de7f1544",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Import Relevant Libraies\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "import numpy as np\n",
    "import seaborn as sns\n",
    "import requests\n",
    "from sklearn.pipeline import Pipeline\n",
    "from sklearn.preprocessing import StandardScaler, PolynomialFeatures\n",
    "from sklearn.linear_model import LinearRegression, Ridge\n",
    "from sklearn.metrics import mean_squared_error, r2_score\n",
    "from sklearn.model_selection import cross_val_score, train_test_split"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fb94783d-9961-4ba1-8032-60ff3ea2a013",
   "metadata": {},
   "source": [
    "# Two Methods To Load and Read Data into DataFrame"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7c0c7619-60e3-419b-8196-f9ee2449fd57",
   "metadata": {},
   "source": [
    "## Auto Dataset"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "c28c1a0f-879a-40f0-acc8-bb3842b95175",
   "metadata": {},
   "outputs": [],
   "source": [
    "url = \"https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBMDeveloperSkillsNetwork-DA0101EN-SkillsNetwork/labs/Data%20files/auto.csv\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "ca87ac7e-ac45-43e7-bb7f-94ba3db616e5",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Download completed\n"
     ]
    }
   ],
   "source": [
    "response = requests.get(url)\n",
    "with open(\"auto.csv\", \"wb\") as f:\n",
    "    f.write(response.content)\n",
    "print(\"Download completed\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "ac2fa4e4-3b1d-4fea-bd41-afe2a7db3021",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = pd.read_csv(\"auto.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "5e9749a9-1ca6-4cbf-b7cf-0375a08de14f",
   "metadata": {},
   "outputs": [],
   "source": [
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "b2600ae6-908a-4e86-8bda-217993709333",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Download completed: auto.csv\n"
     ]
    }
   ],
   "source": [
    "import urllib.request\n",
    "\n",
    "url = \"https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBMDeveloperSkillsNetwork-DA0101EN-SkillsNetwork/labs/Data%20files/auto.csv\"\n",
    "filename = \"auto.csv\"  # this will appear in the Jupyter working directory\n",
    "\n",
    "urllib.request.urlretrieve(url, filename)\n",
    "\n",
    "print(\"Download completed:\", filename)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "5a0f8a94-fd34-40dd-9d5d-da61be782d58",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = pd.read_csv(\"auto.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "465b48e0-4dd5-4a13-85e9-7a3af7b7670b",
   "metadata": {},
   "outputs": [],
   "source": [
    "df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7f284723-7cef-4695-9bee-13a28fdbc5db",
   "metadata": {},
   "source": [
    "## laptops Pricing Dataset"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "f31c2d82-3fb8-4e6d-b55f-77aae3451d7f",
   "metadata": {},
   "outputs": [],
   "source": [
    "url = \"https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBMDeveloperSkillsNetwork-DA0101EN-Coursera/laptop_pricing_dataset_base.csv\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "1fa43afa-5185-43e7-987c-70922fdc864a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Download completed: laptops.csv\n"
     ]
    }
   ],
   "source": [
    "import urllib.request\n",
    "filename = \"laptops.csv\"  # this will appear in the Jupyter working directory\n",
    "urllib.request.urlretrieve(url, filename)\n",
    "\n",
    "print(\"Download completed:\", filename)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "1a1115f4-69bf-4a8d-bba4-0b1f59049fce",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Read Dataset into a Pandas DataFrame\n",
    "df = pd.read_csv(\"laptops.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8947d1c1-9c07-48e1-87e9-bc2272c7a2bd",
   "metadata": {},
   "outputs": [],
   "source": [
    "df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "55fcba22-2c63-4a37-828d-d9cf3f3b8f30",
   "metadata": {},
   "source": [
    "## Insurance Cost Analysis"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e0fbe3d8-142a-440a-9702-ce673d10a447",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Download the Dataset to the Local Environment\n",
    "url = \"https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBMDeveloperSkillsNetwork-DA0101EN-Coursera/medical_insurance_dataset.csv\"\n",
    "\n",
    "response = requests.get(url)\n",
    "with open(\"insurance.csv\", \"wb\") as f:\n",
    "    f.write(response.content)\n",
    "print(\"Download completed\")\n",
    "\n",
    "# Load the Dataset into a Pandas DataFrame\n",
    "df = pd.read_csv(\"insurance.csv\")\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4163b605-f857-4d9e-abc1-4cd53d945462",
   "metadata": {},
   "source": [
    "## Data Wrangling"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "829893f3-d49c-405f-a408-f701e77a1681",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Add Headers to the DataFrame\n",
    "headers = [\"age\", \"gender\", \"bmi\", \"no_of_children\", \"smoker\", \"region\", \"charges\"]\n",
    "df.columns = headers\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e9af0166-c0f1-420a-9245-de1070a30ba9",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Verify Datatypes of the Columns\n",
    "df.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a09dfdf3-7c07-4915-bbb4-f91ba38b52be",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Verify the Unique Values of Age Column (Remove '?')\n",
    "df[\"age\"].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0af39784-70d9-41d2-b76f-9b439aaa2e7f",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Verify the Unique Values of Smoker Column (Remove '?')\n",
    "df[\"smoker\"].unique()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 79,
   "id": "222e6f00-8f68-441c-990a-67fb78595cab",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Replace the '?' Entries with 'NaN' Values.\n",
    "df.replace('?', np.nan, inplace = True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "bc8d3f2a-4133-47ef-bd33-8d1787aa6370",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Check Missing Values\n",
    "df.isnull().sum()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "48034850-ed2e-40b8-a17c-571b9992c171",
   "metadata": {},
   "source": [
    "Handle missing data:\n",
    "\n",
    "- For continuous attributes (e.g., age), replace missing values with the mean.\n",
    "- For categorical attributes (e.g., smoker), replace missing values with the most frequent value.\n",
    "- Update the data types of the respective columns.\n",
    "- Verify the update using \"df.info()\"."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 80,
   "id": "5a7ede3b-3aa2-4c23-b4d9-ab336bd2677e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "0\n"
     ]
    }
   ],
   "source": [
    "# Checking the Most Frequent Values for Categorical Variables\n",
    "most_frequent = df['smoker'].mode()[0]\n",
    "print(most_frequent)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0fc5b312-c556-488c-982e-8a05624e7b5b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Replacing Missing Values with the Most Frequent Values for Categorical Variables\n",
    "df['smoker'] = df['smoker'].fillna(most_frequent)\n",
    "\n",
    "# Verify Whether There is Still Missing Values\n",
    "df.isnull().sum()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "84d6fa25-654d-4fa5-b03b-f73c9ab2c9cf",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Convert Age as a String to Numbers\n",
    "df['age'] = pd.to_numeric(df['age'], errors='coerce')\n",
    "\n",
    "# Verify the Conversion\n",
    "df.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 83,
   "id": "09dbc82e-cb26-4879-a9fc-4f1afaea2af6",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "39.11709432598482\n"
     ]
    }
   ],
   "source": [
    "# Compute Mean Age\n",
    "mean_age = df['age'].mean()\n",
    "print(mean_age)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0c9caeed-d356-4c81-9eb1-b4c750458a09",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Replacing Missing Values with the Average Age Value for Numerical Variables\n",
    "df['age'] = df['age'].fillna(mean_age)\n",
    "\n",
    "# Verify Whether There is Still Missing Values\n",
    "df.isnull().sum()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b20e5881-df57-4507-a418-a135fa8a569b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Convert to Integers\n",
    "df[['age', 'smoker']] = df[['age', 'smoker']].astype(int)\n",
    "\n",
    "# Verify the Conversion\n",
    "df[['age', 'smoker']].dtypes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "082b1c70-b591-43a4-a8b5-82240130c21e",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Round the Charges Column to 2 Decimal Places\n",
    "df['charges'] = df['charges']\n",
    "\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e5cc9568-e27d-4597-8481-1fd34a8e6a15",
   "metadata": {},
   "source": [
    "## Exploratory Data Analysis"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "01fef471-a291-4cb6-92b2-6d483f4b8774",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Show the Relationship Between `charges` and`bmi` using Regression Plot\n",
    "sns.regplot(\n",
    "    x=\"bmi\",\n",
    "    y=\"charges\",\n",
    "    data=df,\n",
    "    line_kws={\"color\": \"red\"},\n",
    "    scatter_kws={\"alpha\": 0.5}\n",
    ")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b72e73c5-2be4-4383-b9fe-60c4b7396604",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Visualize the Relationship Between Smoker and Charges using a Box Plot\n",
    "sns.set_style(\"white\")\n",
    "\n",
    "plt.figure(figsize=(8, 6))\n",
    "\n",
    "sns.boxplot(\n",
    "    x=\"smoker\",\n",
    "    y=\"charges\",\n",
    "    hue=\"smoker\",              # assign hue to avoid warning\n",
    "    data=df,\n",
    "    palette=[\"#4C72B0\", \"#DD8452\"],\n",
    "    width=0.5,\n",
    "    linewidth=1.5,\n",
    "    fliersize=4,\n",
    "    legend=False               # prevent duplicate legend\n",
    ")\n",
    "\n",
    "plt.xlabel(\"Smoker\")\n",
    "plt.ylabel(\"Insurance Charges\")\n",
    "plt.title(\"Insurance Charges by Smoking Status\")\n",
    "\n",
    "plt.tight_layout()\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "543bd5de-8276-4603-8ebd-2a89d9c74189",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Create the Correlation Matrix of the Dataset\n",
    "df.corr()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "edafde93-154c-4a8e-8937-fe12f33ce2fd",
   "metadata": {},
   "source": [
    "## Model Development\n",
    "\n",
    "Fit a linear regression model that may be used to predict the `charges` value, just by using the `smoker` attribute of the dataset. Print the $ R^2 $ score of this model.\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "21e05aac-5fb0-4ca4-b542-16900f9854da",
   "metadata": {},
   "source": [
    "### Simple Linear Regression (SLR)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d61a661c-ec06-4768-8f80-369948a81694",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Define Variables\n",
    "X = df[[\"smoker\"]]      \n",
    "Y = df[\"charges\"]\n",
    "\n",
    "# Train–test split\n",
    "X_train, X_test, Y_train, Y_test = train_test_split(X, Y, test_size=0.45, random_state=0)\n",
    "\n",
    "# Specify the Pipeline\n",
    "pipe_slr = Pipeline([\n",
    "    (\"scale\", StandardScaler()),\n",
    "    (\"lr\", LinearRegression())\n",
    "])\n",
    "\n",
    "# Train the Pipeline\n",
    "pipe_slr.fit(X_train, Y_train)\n",
    "\n",
    "# Evaluate Model Performance\n",
    "r2_train_slr = pipe_slr.score(X_train, Y_train)\n",
    "r2_test_slr  = pipe_slr.score(X_test, Y_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 93,
   "id": "cfd5d7bb-ba6e-4f5d-bdcf-a0d6253c1a43",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.63"
      ]
     },
     "execution_count": 93,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Round R^2 to 2 Decimal Places\n",
    "round(r2_train_slr, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 94,
   "id": "57a5ce7b-c135-44d3-b2c5-660e9faa0efa",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.61"
      ]
     },
     "execution_count": 94,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Round R^2 to 2 Decimal Places\n",
    "round(r2_test_slr, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 95,
   "id": "4bb82256-ba4f-4054-ab2d-cf90dc87cc0c",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([8254.1685823, 8254.1685823])"
      ]
     },
     "execution_count": 95,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "y_pred_slr = pipe_slr.predict(X_test)\n",
    "y_pred_slr[:2]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "af73d41c-72a6-4b7e-beed-49c25df05bcd",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Residual Plot\n",
    "residuals = Y_test - y_pred_slr\n",
    "plt.figure()\n",
    "plt.scatter(y_pred_slr, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "328b332f-e40f-4b83-908c-6836633ad535",
   "metadata": {},
   "source": [
    "### Multiple Linear Regression"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 98,
   "id": "20612ef9-8b53-4342-b3a2-a636eb78f233",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Define the Variables\n",
    "Z = df[[\"age\", \"gender\", \"bmi\", \"no_of_children\", \"smoker\", \"region\"]]\n",
    "Y = df[\"charges\"]\n",
    "\n",
    "# Train–test split\n",
    "Z_train, Z_test, Y_train, Y_test = train_test_split(Z, Y, test_size=0.45, random_state=0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 99,
   "id": "6755a06f-10a9-447c-b922-3abb28d36e0e",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Specify the Pipeline\n",
    "pipe_mlr = Pipeline([\n",
    "    (\"scale\", StandardScaler()),\n",
    "    (\"lr\", LinearRegression())\n",
    "])\n",
    "\n",
    "# Train the Pipeline\n",
    "pipe_mlr.fit(Z_train, Y_train)\n",
    "\n",
    "# Evaluate Model Performance\n",
    "r2_train_mlr = pipe_mlr.score(Z_train, Y_train)\n",
    "r2_test_mlr  = pipe_mlr.score(Z_test, Y_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 100,
   "id": "8d7fdf7a-f296-4b00-9d2f-735c4b8820f5",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.76"
      ]
     },
     "execution_count": 100,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Round R^2 to 2 Decimal Places\n",
    "round(r2_train_mlr, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 101,
   "id": "2c90f7a1-054b-4630-8f3a-c286da19fb9a",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.74"
      ]
     },
     "execution_count": 101,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Round R^2 to 2 Decimal Places\n",
    "round(r2_test_mlr, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 102,
   "id": "c5e66c55-1871-40a8-a6db-1795d90aef44",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([10511.00886608,    89.54336507])"
      ]
     },
     "execution_count": 102,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Predict Charges\n",
    "y_pred_mlr = pipe_mlr.predict(Z_test)\n",
    "y_pred_mlr[:2]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1d6e40f9-d348-4bfe-a4f4-c673872b1f6c",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Residual Plot\n",
    "residuals = Y_test - y_pred_mlr\n",
    "plt.figure()\n",
    "plt.scatter(y_pred_mlr, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4719e14d-4d2b-4bd1-b97f-9b2dbbab207e",
   "metadata": {},
   "source": [
    "## Model Refinement\n",
    "\n",
    "Initialize a Ridge regressor that used hyperparameter $ \\alpha = 0.1 $. Fit the model using training data data subset. Print the $ R^2 $ score for the testing data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 104,
   "id": "f1da5998-9b30-43ce-9fe3-457f9f8f717c",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.74"
      ]
     },
     "execution_count": 104,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Define the Pipeline\n",
    "pipe_ridge = Pipeline([\n",
    "    (\"scale\", StandardScaler()),\n",
    "    (\"ridge\", Ridge(alpha=0.1))\n",
    "])\n",
    "\n",
    "# Train the Pipeline\n",
    "pipe_ridge.fit(Z_train, Y_train)\n",
    "\n",
    "# Evaluate Performance\n",
    "r2_test_ridge = pipe_ridge.score(Z_test, Y_test)\n",
    "round(r2_test_ridge, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 105,
   "id": "29bc54e9-7e25-428b-8415-543581fc2726",
   "metadata": {},
   "outputs": [],
   "source": [
    "y_pred_ridge = pipe_ridge.predict(Z_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "566b1edd-6f1c-4e32-9b65-54a8fb12c987",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Residual Plot\n",
    "residuals = Y_test - y_pred_ridge\n",
    "plt.figure()\n",
    "plt.scatter(y_pred_ridge, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9f5ec3eb-10f1-4fe2-ad7f-3bc62f91cb0f",
   "metadata": {},
   "source": [
    "## House Sales Dataset in King County, USA"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 107,
   "id": "cbeb68ff-1e5c-4bf3-b963-913de43e1aff",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Download completed\n"
     ]
    }
   ],
   "source": [
    "# Download the Dataset to the Local Environment\n",
    "url = \"https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBMDeveloperSkillsNetwork-DA0101EN-SkillsNetwork/labs/FinalModule_Coursera/data/kc_house_data_NaN.csv\"\n",
    "response = requests.get(url)\n",
    "with open(\"housing.csv\", \"wb\") as f:\n",
    "    f.write(response.content)\n",
    "print(\"Download completed\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6f3a8191-81f6-4c2b-b4bb-ab379ca3c5d8",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Load the Dataset into a Pandas DataFrame\n",
    "df = pd.read_csv(\"housing.csv\")\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6aa046ea-6370-4352-bf6f-bf37953ff8b9",
   "metadata": {},
   "source": [
    "## Question 1\n",
    "\n",
    "Display the data types of each column using the function dtypes."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e1a8e9c0-1ae0-4d1a-848c-9692a117e33a",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Check Data Types\n",
    "df.dtypes"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e2924726-7cbe-4586-95a7-02154aac5f58",
   "metadata": {},
   "source": [
    "## Question 2\n",
    "\n",
    "Drop Irrelevant Columns (id and Unnamed:0 Columns)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "bd069f81-9057-43ea-9d42-118079d58c7b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Drop the Columns\n",
    "df.drop(columns=[\"id\", \"Unnamed: 0\"], inplace=True)\n",
    "\n",
    "# Let's take a look at the updated DataFrame\n",
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "da43bd64-6170-4a87-8780-2279940fff86",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Check Missing Values ({bedrooms:13, bathrooms:10})\n",
    "df.isna().sum()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 112,
   "id": "1ceb0435-d8e7-4d5e-ac93-70abcf126995",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Compute and Replace Each Column with its Respective Means\n",
    "cols = [\"bedrooms\", \"bathrooms\"]\n",
    "df[cols] = df[cols].fillna(df[cols].mean())"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0d0cb606-32f8-4501-be8a-feb8e3febd0e",
   "metadata": {},
   "source": [
    "# Exploratory Data Analysis\n",
    "\n",
    "## Question 3\n",
    "\n",
    "Use the method value_counts to count the number of houses with unique floor values"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "343c4821-de40-4d64-b642-b1683d2c3c8a",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Count Number of Houses with Unique Floors\n",
    "df[\"floors\"].value_counts()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f672e0b7-da87-421c-a044-a2aa9b10fb55",
   "metadata": {},
   "source": [
    "## Likely Insights\n",
    "\n",
    "### Descriptive insight (what happened?)\n",
    "- Frequencies\n",
    "- Averages\n",
    "- Distributions\n",
    "\n",
    "Example:\n",
    "“10,680 houses have 1 floor; 8,241 houses have 2 floors”\n",
    "\n",
    "### Analytical (diagnostic in this example) insight (why?)\n",
    "\n",
    "Example:\n",
    "Single-floor houses dominate because the dataset includes many suburban properties with larger land plots.\n",
    "\n",
    "### Predictive insight (what will happen?)\n",
    "\n",
    "Example:\n",
    "Houses with two floors tend to have higher prices, suggesting vertical expansion adds value.\n",
    "\n",
    "### Prescriptive insight (what should be done?)\n",
    "\n",
    "Example:\n",
    "Developers targeting this market should prioritize two-floor designs for higher resale value."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "69903434-c926-4da7-843d-15ce8d4508fd",
   "metadata": {},
   "source": [
    "## Question 4\n",
    "\n",
    "Use the function boxplot in the seaborn library to determine whether houses with a waterfront view or without a waterfront view have more price outliers."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e395b7fd-021e-435d-ac0c-93cd6f09eeba",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Create a Boxplot\n",
    "sns.boxplot(x=\"waterfront\", y=\"price\", data=df)\n",
    "plt.xlabel(\"Waterfront (0 = No, 1 = Yes)\")\n",
    "plt.ylabel(\"House Price\")\n",
    "plt.title(\"House Prices by Waterfront View\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d0c867a9-6d97-4b3e-bffb-72531278a1c7",
   "metadata": {},
   "source": [
    "## Likely Insights\n",
    "\n",
    "### Descriptive Insight:\n",
    "\n",
    "#### Houses with a waterfront view (1):\n",
    "\n",
    " - Have many more high-price outliers\n",
    "\n",
    " - Show a much higher median price\n",
    "\n",
    " - Have a wider price spread\n",
    "\n",
    "#### Houses without a waterfront view (0):\n",
    "\n",
    " - Have fewer and less extreme outliers\n",
    "\n",
    " - Prices are more tightly clustered\n",
    "\n",
    "\n",
    "## Analytical Insight\n",
    "\n",
    "- Houses with a waterfront view exhibit more price outliers than houses without a waterfront view, indicating that waterfront properties can command exceptionally high prices."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "947b9143-3ac6-42fc-843f-dcccb6f6edf3",
   "metadata": {},
   "source": [
    "## Question 5\n",
    "\n",
    "Use regplot in the seaborn library to determine if the feature sqft_above is negatively or positively correlated with price."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6e0a149b-1d0e-4a3b-84d1-58eea6082b4b",
   "metadata": {},
   "outputs": [],
   "source": [
    "sns.regplot(x=\"sqft_above\", y=\"price\", data=df)\n",
    "plt.xlabel(\"Square Footage Above Ground\")\n",
    "plt.ylabel(\"House Price\")\n",
    "plt.title(\"Price vs Sqft Above\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f9ed7df2-f022-40ed-926f-a97c61c75699",
   "metadata": {},
   "source": [
    "# Model Development\n",
    "\n",
    "## Simple Linear Regression Model\n",
    "\n",
    "Fit a linear regression model using the longitude feature 'long' and caculate the R^2."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 144,
   "id": "dde4ecf4-43f7-4604-8d2d-a952d29faf07",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.0006"
      ]
     },
     "execution_count": 144,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Define Variables\n",
    "x = df[[\"long\"]]\n",
    "y = df[\"price\"]\n",
    "\n",
    "# Train–test split\n",
    "x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.45, random_state=0)\n",
    "\n",
    "# Specify the Pipeline\n",
    "pipe_slr = Pipeline([\n",
    "    (\"scale\", StandardScaler()),\n",
    "    (\"lr\", LinearRegression())\n",
    "])\n",
    "\n",
    "# Train the Pipeline\n",
    "pipe_slr.fit(x_train, y_train)\n",
    "\n",
    "# Evaluate Model Performance\n",
    "r2_test_slr  = pipe_slr.score(x_test, y_test)\n",
    "round(r2_test_slr, 5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "7f5644c3-f244-4d21-91d9-1ac1f813e2d1",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Predct the Price\n",
    "y_pred = pipe_slr.predict(x_test)\n",
    "\n",
    "# Residual Plot\n",
    "residuals = y_test - y_pred\n",
    "plt.figure()\n",
    "plt.scatter(y_pred, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "15dc012e-2ecd-4ea4-aacd-ca0ad2406881",
   "metadata": {},
   "source": [
    "## Question 6\n",
    "\n",
    "Fit a linear regression model to predict the 'price' using the feature 'sqft_living' then calculate the R^2."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 146,
   "id": "c632e757-74ba-448d-a0b5-0f132ce2039b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.5"
      ]
     },
     "execution_count": 146,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Define Variables\n",
    "x = df[[\"sqft_living\"]]\n",
    "y = df[\"price\"]\n",
    "\n",
    "# Train–test split\n",
    "x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.45, random_state=0)\n",
    "\n",
    "# Specify the Pipeline\n",
    "pipe_slr = Pipeline([\n",
    "    (\"scale\", StandardScaler()),\n",
    "    (\"lr\", LinearRegression())\n",
    "])\n",
    "\n",
    "# Train the Pipeline\n",
    "pipe_slr.fit(x_train, y_train)\n",
    "\n",
    "# Evaluate Model Performance\n",
    "r2_test_slr  = pipe_slr.score(x_test, y_test)\n",
    "round(r2_test_slr, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 147,
   "id": "209a3fd2-1c01-48b6-b691-553f563869a6",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Predct the Price\n",
    "y_pred = pipe_slr.predict(x_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6f1c51c3-7ec8-40ca-89f2-2742f0152b65",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Residual Plot\n",
    "residuals = y_test - y_pred\n",
    "plt.figure()\n",
    "plt.scatter(y_pred, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 139,
   "id": "776d08dd-f3c1-4609-9ee7-f54b0a546818",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([ 363287.42520865, 1251433.50956838])"
      ]
     },
     "execution_count": 139,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Predict the Price\n",
    "y_pred = pipe_slr.predict(x_test)\n",
    "y_pred[:2]"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "677dafed-874b-4af9-875f-de08f0a23e29",
   "metadata": {},
   "source": [
    "## Multiple Linear Regression Model\n",
    "\n",
    "## Question 7\n",
    "\n",
    "Fit a linear regression model to predict the 'price'  and calculate R^2 using the list of features below:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 134,
   "id": "3ea87299-cea6-497c-b850-ce23094323fb",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Define the Model Variables\n",
    "Z = df[[\"floors\", \"waterfront\",\"lat\" ,\"bedrooms\" ,\"sqft_basement\" ,\"view\" ,\"bathrooms\",\"sqft_living15\",\"sqft_above\",\"grade\",\"sqft_living\"]]\n",
    "Y = df[\"price\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 149,
   "id": "840ee5ca-0f66-483a-b2c4-bd2bcd112b8b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.65"
      ]
     },
     "execution_count": 149,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Train–test split\n",
    "Z_train, Z_test, Y_train, Y_test = train_test_split(Z, Y, test_size=0.45, random_state=0)\n",
    "\n",
    "# Specify the Pipeline\n",
    "pipe_mlr = Pipeline([\n",
    "    (\"scale\", StandardScaler()),\n",
    "    (\"lr\", LinearRegression())\n",
    "])\n",
    "\n",
    "# Train the Pipeline\n",
    "pipe_mlr.fit(Z_train, Y_train)\n",
    "\n",
    "# Evaluate Model Performance\n",
    "r2_test_mlr  = pipe_mlr.score(Z_test, Y_test)\n",
    "round(r2_test_mlr, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 150,
   "id": "049aedb6-bb87-4db2-935a-be056d88bfb8",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([ 445818.96672622, 1383525.26217687])"
      ]
     },
     "execution_count": 150,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Predict Price\n",
    "y_pred = pipe_mlr.predict(Z_test)\n",
    "y_pred[:2]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "bc752a25-7125-4017-b103-d97afe426d12",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Residual Plot\n",
    "residuals = Y_test - y_pred\n",
    "plt.figure()\n",
    "plt.scatter(y_pred, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7e453d01-c12e-46e2-8c3f-e2093efb0f41",
   "metadata": {},
   "source": [
    "# Model Evaluation and Refinement\n",
    "\n",
    "## Question 8\n",
    "\n",
    "Fit polynomial regression model to predict the price and calculate R^2 using the list of features below."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 167,
   "id": "8cff2ffe-888b-47bd-998e-6149c8a7e1d4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.74"
      ]
     },
     "execution_count": 167,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Define the Model Variables\n",
    "Z = df[[\"floors\", \"waterfront\",\"lat\" ,\"bedrooms\" ,\"sqft_basement\" ,\"view\" ,\"bathrooms\",\"sqft_living15\",\"sqft_above\",\"grade\",\"sqft_living\"]]\n",
    "Y = df[\"price\"]\n",
    "\n",
    "# Define the Pipeline\n",
    "pipe_deg2 = Pipeline([\n",
    "    (\"scale\", StandardScaler()),\n",
    "    (\"poly\", PolynomialFeatures(degree=2, include_bias=False)),\n",
    "    (\"lr\", LinearRegression())\n",
    "])\n",
    "\n",
    "# Train the Model\n",
    "pipe_deg2.fit(Z_train, Y_train)\n",
    "\n",
    "# Evaluate Performance of the Model\n",
    "r2_test_deg2  = pipe_deg2.score(Z_test, Y_test)\n",
    "\n",
    "round(r2_test_deg2, 2) "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 183,
   "id": "7eb2fb34-fd8e-42a7-9099-99654ad1d2cb",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([ 441654.78, 1539346.4 ])"
      ]
     },
     "execution_count": 183,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Predict the Price\n",
    "y_pred_poly = pipe_deg2.predict(Z_test)\n",
    "np.round(y_pred_poly[:2], 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1521ed79-8900-479d-ad07-529a2faffeb8",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Residual Plot\n",
    "residuals = Y_test - y_pred_poly\n",
    "plt.figure()\n",
    "plt.scatter(y_pred_poly, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0a3ee9ef-c554-41f2-be82-f641125ce8fa",
   "metadata": {},
   "source": [
    "## Question 9\n",
    "\n",
    "Fit a ridge regression, set the regularization parameter to 0.1, and calculate the R^2 using the test data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 175,
   "id": "7091cfb8-c821-4ec5-b112-d6544581006d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.65"
      ]
     },
     "execution_count": 175,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Define the Pipeline\n",
    "pipe_ridge = Pipeline([\n",
    "    (\"scale\", StandardScaler()),\n",
    "    (\"ridge\", Ridge(alpha=0.1))\n",
    "])\n",
    "\n",
    "# Train the Pipeline\n",
    "pipe_ridge.fit(Z_train, Y_train)\n",
    "\n",
    "# Evaluate Performance\n",
    "r2_test_ridge = pipe_ridge.score(Z_test, Y_test)\n",
    "round(r2_test_ridge, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "3062d802-75e1-4910-9057-3b2cb7e92a0b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Predict zhe Price\n",
    "y_pred_ridge = pipe_ridge.predict(Z_test)\n",
    "\n",
    "# Residual Plot\n",
    "residuals = Y_test - y_pred_ridge\n",
    "plt.figure()\n",
    "plt.scatter(y_pred_ridge, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6361f5d6-a9c5-41cf-a468-b6f33a6d6b1a",
   "metadata": {},
   "source": [
    "# Interaction Model\n",
    "\n",
    "Fit an interaction regression model on the relevant features and calculate R^2."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 176,
   "id": "470370fa-8db2-48ff-9594-1e1a4743da7d",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Specify the Interaction Model with the Features\n",
    "pipe_interact = Pipeline([\n",
    "    ('scale', StandardScaler()),\n",
    "    ('poly', PolynomialFeatures(\n",
    "        degree=2,\n",
    "        interaction_only=True,\n",
    "        include_bias=False\n",
    "    )),\n",
    "    ('ridge', Ridge(alpha=1.0))\n",
    "])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 177,
   "id": "5a117bdb-46b9-47d3-952c-299015a52abe",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.72"
      ]
     },
     "execution_count": 177,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Fit Interaction Model \n",
    "pipe_interact.fit(Z_train, Y_train)\n",
    "\n",
    "# Evaluate Performance of the Model\n",
    "r2_test_interact = pipe_interact.score(Z_test, Y_test)\n",
    "round(r2_test_interact, 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 184,
   "id": "e0571228-fe9b-46e3-baac-f494f94fe066",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([ 466562.47, 1563753.58])"
      ]
     },
     "execution_count": 184,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Predict the Price\n",
    "y_pred_interact = pipe_interact.predict(Z_test)\n",
    "y_pred_interact[:2]\n",
    "np.round(y_pred_interact[:2], 2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "8ba74a7b-b6d0-456f-be0f-2f7b04da3d01",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Predict zhe Price\n",
    "y_pred_interact = pipe_interact.predict(Z_test)\n",
    "\n",
    "# Residual Plot\n",
    "residuals = Y_test - y_pred_interact\n",
    "plt.figure()\n",
    "plt.scatter(y_pred_interact, residuals)\n",
    "plt.axhline(0)\n",
    "plt.xlabel(\"Predicted values\")\n",
    "plt.ylabel(\"Residuals\")\n",
    "plt.title(\"Residuals vs Predicted\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b7985b82-d972-4daa-b95c-ef48a3b69e1b",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python (dataenv)",
   "language": "python",
   "name": "dataenv"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.14"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
